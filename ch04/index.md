# 4. 테스트 구축하기

## 4.1 자가 테스트 코드의 가치

코드를 작성하기 전에 자가 테스트 코드부터 작성해라.
개발자 대부분은 디버깅에 시간을 많이 쓰고, 디버깅을 하면서 버그를 고치다가 새로운 버그를 만들기도 한다.
테스트 코드를 열심히 작성하는것이 디버깅 시간을 줄이는 것이기 때문에 테스트 코드를 작성하는 것이 좋다.

## 4.2 테스트할 샘플 코드

생산 계획 -> 지역의 수요와 가격으로 구성
지역의 생산자 -> 특정 가격으로 특정 수량만큼 생산 가능
UI에서는 생산자별로 제품을 모두 판매했을때의 수익을 보여준다.
UI에서는 생산 부족분과 현재 계획에서의 총수익도 보여준다.

사용자는 UI에서 수요, 가격, 생산자별 생산량과 비용을 조절할 수 있는데, 조절한 결과에 맞춰 UI가 즉각 반응하게 된다.

하지만 지금은 리팩토링의 필요성을 위한 자가 테스트를 만들어야 하기 때문에 비즈니스 로직만 따로 떼어서 확인한다.

## 4.4 테스트 추가하기

중요한 부분만 테스트를 추가하는것이 좋다.
getter, setter같은 부분에 테스트는 버그가 있을 확률이 거의 없고, 자잘한 테스트까지 신경쓰다보면
정작 중요한 부분의 테스트를 놓치는 경우가 생길 수 있기 떄문이다.

```javascript
//with jasmine testing lib

describe("province", function () {
  const asia = new Province(sampleProvinceData());

  it("shortfall", function () {
    expect(asia.shortfall).toBe(5);
  });

  it("profit", function () {
    expect(asia.profit).toBe(230);
  });
});
```

이런식의 코드는 asia라는 참조를 공유하기 때문에 실행 순서에 따라 결과가 달라질 수 있다는 문제가 있다.
이런 경우는 아래처럼 해결할 수 있다.

```javascript
describe("province", function () {
  let asia;

  beforeEach(function () {
    asia = new Province(sampleProvinceData());
  });

  it("shortfall", function () {
    expect(asia.shortfall).toBe(5);
  });

  it("profit", function () {
    expect(asia.profit).toBe(230);
  });
});
```

`beforEach`를 통해 각 테스트를 새로운 asia를 사용하게 만들면 문제점을 해결할 수 있다.

## 4.5 픽스처 수정하기

- 테스트 패턴
  - 설정-실행-검증
  - 조건-발생-결과
  - 준비-수행-단언

해체, 청소라고 부르는 4번째 단계가 있는데 명시적으로 언급하지 않을때가 많다.
테스트를 하기 위해 할당안 자원들을 안전하게 제거하는 작업을 뜻한다.
beforEach와 같은 구문에서 자원을 할당하게 된다면 대부분 테스트 라이브러리에서 자체적으로 자원을 청소해주는데,
생성하는데 오래 걸리는 자원들이라서 여러 테스트에서 공유해야되는 경우처럼 명시적으로 자원을 청소해주어야 하는 경우도 있다.

it 구문 하나당 한개의 검증만 하는게 좋다.
여러 검증 중 하나를 실패하게 되면 해당 테스트는 건너뛰게 되는데, 건너뛰어서 유용한 정보를 놓치게 될 수도 있기 떄문이다.
4.4의 예시에서는 2개의 검증을 한 이유는 한 테스트로 볼 만큼 두 속성이 밀접하다고 판단되어서였다.

## 4.6 경계 조건 검사하기

예상치 못한 값들에 대한 테스트도 같이 작성하는게 좋다.
producers와 같은 배열은 빈 배열일때 어떤 일이 생기는지 확인하는 편이다.

UI에서 수요를 입력받고 있으니 음수인 경우도 테스트해보는게 좋다.

> 어차피 모든 버그를 잡아낼 수는 없다고 생각해 테스트를 작성하지 않는다면 대다수의 버그를 잡을 수 있는 기회를 날리는 셈이다.

## 4.7 끝나지 않은 여정

실력이 엄청나게 뛰어난게 아니라면 한번에 완벽한 테스트를 갖출 수는 없다.

> 버그 리포트를 받으면 그 버그를 드러내는 단위 테스트를 작성하자.
